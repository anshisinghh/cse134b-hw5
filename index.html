<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="description" content="Rating Widget.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Rating Widget</title>
        <link rel="stylesheet" type="text/css" href="style.css" media="screen">
    </head>
    <body>
        <header>
            <h1>Rating Widget</h1>
        </header>
        <main>
            <noscript>
                <rating-widget>
                    <form action="https://httpbin.org/post" method="POST"> 
                        <label id="ratingQuestion">How satisfied are you?</label> 
                        <input type="hidden" name= "question" value= "How satisfied are you?">
                        <input type="hidden" name= "sentBy" value= "HTML"> 
                        <input type="number" id="rating" name="rating" min="1" max="5" value="0" required>
                        <button type="submit">Submit</button> 
                    </form>
                </rating-widget>
            </noscript>
            <rating-widget>
                <form id="ratingForm" style="display: none;" action="https://httpbin.org/post" method="POST">
                    <label id="ratingQuestion">How satisfied are you?</label> 
                    <input type="hidden" name= "question" value= "How satisfied are you?">
                    <input type="hidden" name= "sentBy" value= "JavaScript"> 
                    <label for="star1" onmouseover="highlightStars(1)" onmouseout="resetStars()" onclick="submitRating(1)">&#9733;</label>
                    <label for="star2" onmouseover="highlightStars(2)" onmouseout="resetStars()" onclick="submitRating(2)">&#9733;</label>
                    <label for="star3" onmouseover="highlightStars(3)" onmouseout="resetStars()" onclick="submitRating(3)">&#9733;</label>
                    <label for="star4" onmouseover="highlightStars(4)" onmouseout="resetStars()" onclick="submitRating(4)">&#9733;</label>
                    <label for="star5" onmouseover="highlightStars(5)" onmouseout="resetStars()" onclick="submitRating(5)">&#9733;</label>
                </form>
            </rating-widget>
            <p id="thankYouMessage" style="display: none;"></p>
            <button id="resetButton" style="display: none;" onclick="resetRating()">Rate Again</button>
            <script>            
                function highlightStars(starCount) {
                    for (let i = 1; i <= starCount; i++) {
                        const star = document.querySelector(`[for=star${i}]`);
                        star.style.color = '#5e8b62';
                    }
                }
                
                function resetStars() {
                    for (let i = 1; i <= 5; i++) {
                        const star = document.querySelector(`[for=star${i}]`);
                        star.style.color = 'white';
                    }
                }
                
                function submitRating(rating) {
                    document.getElementById('ratingForm').style.display = 'none';
                    const thankYouMessage = document.getElementById('thankYouMessage');
                    thankYouMessage.style.display = 'block';

                    switch (rating) {
                        case 1:
                            thankYouMessage.innerText = "Thank you for rating 1 star. We will do better!";
                            break;
                        case 2:
                            thankYouMessage.innerText = "Thank you for rating 2 stars. We appreciate your feedback!";
                            break;
                        case 3:
                            thankYouMessage.innerText = "Thank you for rating 3 stars. Your feedback helps us improve!";
                            break;
                        case 4:
                            thankYouMessage.innerText = "Thank you for rating 4 stars. We're glad you had a positive experience!";
                            break;
                        case 5:
                            thankYouMessage.innerText = "Thank you for rating 5 stars. We appreciate your support!";
                            break;
                        default:
                            thankYouMessage.innerText = "Thank you for rating ${rating} stars. We value your feedback!";
                            break;
                    }

                    const resetButton = document.getElementById('resetButton');
                    resetButton.style.display = 'block';

                    const formData = new FormData(ratingForm);
                    formData.append('question', document.getElementById('ratingQuestion').innerText);
                    formData.append('rating', rating);

                    const headers = new Headers();
                    headers.append('X-Sent-By', 'JavaScript');

                    fetch(ratingForm.action, {
                        method: 'POST',
                        headers: headers,
                        body: formData,
                    })
                    .then(response => response.json())
                    .then(data => console.log(data))
                    .catch(error => console.error('Error:', error));
                }

                function resetRating() {
                    document.getElementById('ratingForm').style.display = 'block';
                    document.getElementById('thankYouMessage').style.display = 'none';

                    document.getElementById('resetButton').style.display = 'none';

                    resetStars();
                }

                document.getElementById('ratingForm').style.display = 'block';
            </script>
        </main>
    </body>
</html>